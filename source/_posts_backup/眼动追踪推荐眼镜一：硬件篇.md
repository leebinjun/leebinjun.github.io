---
title: 眼动追踪推荐眼镜一：硬件篇
date: 2019-09-24 01:04:25
tags:
---

硬件组成部分主要就是眼镜架、摄像头和供电系统。

可以参考的开源方案有
* Pupil Labs  
https://pupil-labs.com/


当前设计使用的是USB摄像头直接连接电脑的方案：240°鱼眼摄像头被固定在眼镜框正前方负责采集用户视野图像，720P摄像头则固定在右前方伸出的支架上负责采集右眼图像，摄像头通过USB与计算机连接完成图像传输。

以下是对ip摄像头的测试，计划下一步用于眼镜的改进。

<!-- more -->
<The rest of contents | 余下全文>

<html>
<head>
<meta charset="utf-8"> 
<title>title_test</title> 
<script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js">
</script>
<script>
$(document).ready(function(){
    $(document).on('click', '.fold_hider', function(){
        $('>.fold', this.parentNode).slideToggle();
        $('>:first', this).toggleClass('open');
    });
    $("div.fold").css("display","none");
});
</script>
</head>
</html>

## ip摄像头

45元的WIFI摄像头模块，能玩出什么花样？ - 知乎  
https://zhuanlan.zhihu.com/p/60565132

ip摄像头选用ESP32-CAM模块，包括ESP32wifi模块和一个OV2640的200W像素摄像头。

### 烧录固件

硬件连接，注意需要将GPIO0和边上的GND短接进入烧录模式

| USB-TTL    |   ESP32-CAM    |
|  :----:    | :----:         |
| 3.3V       |   VCC          |
| GND        |   GND          |
| RX         |   U0T          |
| TX         |   U0R          |
|            |   IO0和GND短接  |

<img src = "眼动追踪推荐眼镜一：硬件篇\01.jpg">

烧录工具我们用的是Arduino IDE，首先需要添加ESP32的芯片支持  
打开首选项，在附加开发板管理器网址里填上：https://dl.espressif.com/dl/package_esp32_index.json ，然后单击 好 。
<img src = "眼动追踪推荐眼镜一：硬件篇\04.png">


然后在工具里打开开发板管理器，等待索引做完之后找到ESP32并安装。
<img src = "眼动追踪推荐眼镜一：硬件篇\00.png">

在github下载示例代码。  
* RuiSantosdotme/arduino-esp32-CameraWebServer: CameraWebServer for ESP32-CAM in Arduino IDE  
https://github.com/RuiSantosdotme/arduino-esp32-CameraWebServer


打开CameraWebServer.ino文件，进行一些设置
``` c
// Select camera model
//#define CAMERA_MODEL_WROVER_KIT
//#define CAMERA_MODEL_M5STACK_PSRAM
#define CAMERA_MODEL_AI_THINKER

const char* ssid = "REPLACE_WITH_YOUR_SSID";
const char* password = "REPLACE_WITH_YOUR_PASSWORD";
```



在开发板里面选对我们需要的开发板和相关设置，然后点击上传就好。

<img src = "眼动追踪推荐眼镜一：硬件篇\02.png">


### 测试

通过浏览器输入ESP32-CAM的IP地址，就能看到设置页面了。

点击Start Stream就能看到实时影像了。

通过python脚本读取图像。

<body>
<div>
    <div class="fold_hider">
        <div class="close hider_title">点击显示/隐藏代码</div>
    </div>
    <div class="fold">

```python  
import cv2
import urllib.request
import numpy as np
host = "192.168.0.100:81" # 在这里记得修改ip，否则是无法调用的，刚刚浏览器输入的地址
hoststr = 'http://' + host + '/stream'
print('Streaming ' + hoststr)
print('Print Esc to quit')
stream=urllib.request.urlopen(hoststr)
bytes=bytes()
while True:
    bytes+=stream.read(1024)
    a = bytes.find(b'\xff\xd8')
    b = bytes.find(b'\xff\xd9')
    i = 0
    if a!=-1 and b!=-1:
        jpg = bytes[a:b+2]
        bytes= bytes[b+2:]
        #flags = 1 for color image
        try:
            i = cv2.imdecode(np.fromstring(jpg, dtype=np.uint8),flags=1)
            # print i.shape
            cv2.imshow("wjw",i)
            if cv2.waitKey(1) & 0xFF == ord('q'):
                exit(0)
        except Exception as e:
            print('保存失败', e)
```
</div>
</div>
</body>

<div align=center>
<img src = "眼动追踪推荐眼镜一：硬件篇\06.png">
</div>




### 问题记录

* 编译项目报错 “sketch\app_httpd.cpp:23:20: fatal error: dl_lib.h: No such file or directory”

app_httpd.cpp 中注释相应库
``` c
//#include "dl_lib.h"
```

* 编译项目报错 “ "WiFi.h" 对应多个库
 已使用： C:\Users\Administrator\AppData\Local\Arduino15\packages\esp32\hardware\esp32\1.0.3\libraries\WiFi
 未使用：H:\Program Files\arduino-1.8.3\libraries\WiFi
exit status 1 ”

移除文件夹 H:\Program Files\arduino-1.8.3\libraries\WiFi

* 点击Start Stream没有反应。

<div align=center>
<img src = "眼动追踪推荐眼镜一：硬件篇\03.png">
</div>
使用Chrome浏览器。

* 注意供电。


