---
title: 简单手势分类器
date: 2019-04-24 20:41:48
tags:
  - raspberry 
  - tf
  - opencv
  - python
---
树莓派作为一个视觉传感器，串口实时返回手势分类结果。
## 准备

### 安装tensorflow
维护树莓派交叉编译版本的github项目
* samjabrahams/tensorflow-on-raspberry-pi: TensorFlow for Raspberry Pi</br>https://github.com/samjabrahams/tensorflow-on-raspberry-pi
``` bash
sudo apt install libatlas-base-dev
pip3 install tensorflow
``` 
安装旧版本
``` bash 
$ wget https://github.com/samjabrahams/tensorflow-on-raspberry-pi/releases/download/v0.11.0/tensorflow-0.11.0-py3-none-any.whl
$ sudo pip3 install tensorflow-0.11.0-py3-none-any.whl
```
### 安装serial

安装串口模块
``` bash
$ sudo apt-get install python-serial
$ pip install serial
$ pip install pyserial
```
如果需要指定位置
``` bash
$ sudo pip install --target=/usr/local/lib/python3.5/dist-packages pyserial
```

### 一些包
``` bash
pip install pillow
pip install matplotlib
```

## 数据处理
使用OpenCV的BackgroundSubtractor类，分割前景和背景，获得手势灰度图

## 模型和训练
通过一个小的卷积网络来实现分类，两层卷积+两层全连接

## HC-05蓝牙串口

### 蓝牙配对

连接(rt反接)
* usb-ttl ---------- bluetooth
* RXD &nbsp;&nbsp;&nbsp;&nbsp;---------- TXD
* TXD &nbsp;&nbsp;&nbsp;&nbsp;---------- RXD

按住复位键插USB，进入AT模式
打开串口助手，设置波特率38400，数据位8位，停止位1位，无校验位，加回车换行(发送消息包含换行符)
修改名称
``` bash
→ AT+ NAME=xxx
→ AT+ NAME?
```
设置蓝牙密码，注意两块蓝牙的密码都要一样
``` bash
→ AT+ PSWD=1234
→ AT+ PSWD?
```
设置主从模式
串口调试助手A，将蓝牙A配置为主机模式
``` bash
→ AT+ ROLE=1
→ AT+ ROLE?
```
串口调试助手B，将蓝牙B配置为从机模式
``` bash
→ AT+ ROLE=0
```
设置波特率9600，无校验位，1停止位
``` bash
→ AT+ UART:9600,0,0
→ AT+ UART?
```
设置连接模式
``` bash
→ AT+ CMODE=0
→ AT+ CMODE?
```
查询蓝牙地址，并相互绑定，注意把地址的冒号换成逗号
``` bash
→ AT+ ADDR?
→ AT+ BIND=98d3,32,307440
```


## 结果
查看端口
``` bash
$ ls /dev/tty*
```
运行
``` bash
$ python run.py --serial /dev/ttyUSB0
```
<img src = "简单手势分类器\02.png" width=600 height=300>
<img src = "简单手势分类器\01.png" width=600 height=300>


## 参考博客
* 【Python+OpenCV】目标跟踪-背景分割器：KNN、MOG2和GMG - CSDN博客 </br>https://blog.csdn.net/lwplwf/article/details/73551648
* Tensorflow+树莓派，自制“猜拳神器” - Lauyeed的博客 - CSDN博客</br>https://blog.csdn.net/Lauyeed/article/details/79345685
* 蓝牙模块HC-05使用说明_图文_百度文库</br>http://wenku.baidu.com/link?url=tDhQ1eN2RBFS4-iA9dFZuuYUUb21nx3ZpahLARbDaesVM0HkHMeiLc0NzfR7W6NVqc5F57p0x8t6c_3T3JN4ne9NCEB540mwEYV5kLpFSfq
* AttributeError: module 'serial' has no attribute 'Serial' - m0_37827405的博客 - CSDN博客</br>https://blog.csdn.net/m0_37827405/article/details/80879678
