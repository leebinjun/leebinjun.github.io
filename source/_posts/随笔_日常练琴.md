---
title: Êó•Â∏∏ÁªÉÁê¥
date: 2019-1-1 02:25:33
tags:
  - ÈöèÁ¨î
---

## ËäÇÊãçÂô®

<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- <title>ËäÇÊãçÂô®</title> -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            let speed = 60, //ËäÇÊãçÈÄüÂ∫¶
                arrClick = [],  //ÊµãÈÄüÊó∂ÊØèÊ¨°ÁÇπÂáªÁöÑÈÄüÂ∫¶ÁªÑÊàêÁöÑÊï∞ÁªÑÔºåËäÇÊãçÈÄüÂ∫¶ÂèñÂÖ∂Âπ≥ÂùáÂÄº
                clickTime = 0,  //ÊµãÈÄüÁÇπÂáªËÆ°Êó∂Âô®ÔºåË∂ÖËøá 5 ÁßíÊ∏ÖÁ©∫Êï∞ÁªÑ
                s = Date.now(), //ËÆ∞ÂΩïÊØè‰∏ÄÊ¨°ÁÇπÂáªÁöÑÊó∂Èó¥Ôºå‰∏ã‰∏ÄÊ¨°ÁÇπÂáªÊó∂‰∏éÊ≠§Êó∂Èó¥ÁöÑÈó¥ÈöîÔºåÊù•ËÆ°ÁÆóÈÄüÂ∫¶
                time = 0,   //play ËøáÁ®ã timeout ÂèòÈáè
                times = 0,  //44ÊãçËäÇÁöÑËÆ°Êï∞Âô®
                isPlay = false, //ÊòØÂê¶Ê≠£Âú®Êí≠Êîæ
                speedMsg = document.getElementById("speed"),    //È°µÈù¢Ê≠£‰∏≠Èó¥ÊòæÁ§∫ÈÄüÂ∫¶ÂÄºÁöÑÂÖÉÁ¥†
                rangeValue = document.getElementById("rangeValue"), //ÊªëÂùóÂÖÉÁ¥†
                elSpeed1 = document.getElementById("speed1"),
                elSpeed2 = document.getElementById("speed2"),
                showSpeed = () => {//ÊòæÁ§∫ÈÄüÂ∫¶ÂÄºÁöÑÊñπÊ≥ïÔºàÊàñËÄÖÂè´ update ÊñπÊ≥ïÔºâ
                    rangeValue.value = speedMsg.innerText = speed;
                    elSpeed1.innerText = Math.round(speed / 2);
                    elSpeed2.innerText = speed * 2;
                }; 
            /** ÊµãÈÄüÊåâÈíÆÁÇπÂáª */
            document.getElementById("btnTest").addEventListener("click", function () {
                let lastSpeed = Math.floor(60000 / (Date.now() - s));
                if (Math.abs(lastSpeed - arrClick[arrClick.length - 1]) > 30) { arrClick = []; }  //Â¶ÇÊûúÁÇπÂáªÊó∂Èó¥Âíå‰∏äÊ¨°Â∑ÆÂà´ËæÉÂ§ßÔºåÂàôÊ∏ÖÈõ∂ÈáçÊµã
                arrClick.push(lastSpeed);
                if (arrClick.length > 31) arrClick.shift(); //ÊúÄÂ§ßÂÆπÈáè‰øùÊåÅÂú®30‰∏™ÔºàÈô§ÂéªÁ¨¨ 1 ‰∏™‰∏çÁî®Ôºâ
                //Â¶ÇÊûúÊï∞ÈáèÂ§ö‰∫é1‰∏™ÂàôËÆ°ÁÆóÈÄüÂ∫¶ÔºàÁ¨¨ 1 ‰∏™Êó∂Èó¥Èó¥ÈöîÂ§™‰πÖÔºå‰∏çÂáÜÁ°ÆÔºåÂºÉ‰πãÔºâ
                if (arrClick.length > 1) {
                    //ÂèñÁ¨¨2‰∏™Âà∞ÊúÄÂêéÁöÑÂπ≥ÂùáÂÄº
                    speed = Math.ceil((arrClick.reduce((sum, n) => sum + n) - arrClick[0]) / (arrClick.length - 1));
                    console.log(arrClick.slice(1, arrClick.length).join("+") + " = " + (arrClick.reduce((s, n) => s + n) - arrClick[0]) + " / " + (arrClick.length - 1));
                    if (arrClick.length > 5) document.getElementById("msg").innerText = "Â§öÁÇπÂá†Ê¨°Êõ¥ÂáÜÁ°Æ...";
                }
                showSpeed();
                s = Date.now();
                document.getElementById("btnStop").click(); //ÊµãÈÄüÊó∂ÂÅúÊ≠¢Êí≠Êîæ
                //‰∏§Ê¨°ÁÇπÂáªÈó¥ÈöîÂ§ß‰∫é 3 ÁßíÂ∞±ÈáçÁΩÆ
                window.clearTimeout(clickTime);
                clickTime = window.setTimeout(function () {
                    arrClick = [];
                    document.getElementById("msg").innerText = "";
                }, 3000);
            });
            /** Êí≠ÊîæÊåâÈíÆÁÇπÂáª */
            document.getElementById("btnPlay").addEventListener("click", function () {
                isPlay = true;
                play();
                this.style.display = "none";
                document.getElementById("btnStop").style.display = "inline-block";
            });
            /** ÂÅúÊ≠¢ÊåâÈíÆÁÇπÂáª */
            document.getElementById("btnStop").addEventListener("click", function () {
                window.clearTimeout(time);
                isPlay = false;
                this.style.display = "none";
                document.getElementById("btnPlay").style.display = "inline-block";
            });
            /** ÂáèÂè∑ÊåâÈíÆÁÇπÂáª */
            document.getElementById("btnSub").addEventListener("click", function () {
                speed--;
                showSpeed();
            });
            /** Âä†Âè∑ÊåâÈíÆÁÇπÂáª */
            document.getElementById("btnAdd").addEventListener("click", function () {
                speed++;
                showSpeed();
            });
            document.getElementById("speed1").addEventListener("click",function(){
                speed = this.innerText * 1;
                showSpeed();
            })
            document.getElementById("speed2").addEventListener("click",function(){
                speed = this.innerText * 1;
                showSpeed();
            })
            /** ÊªëÂä®Êù°Êõ¥Êîπ */
            rangeValue.addEventListener("change", function () {
                speed = this.value * 1;
                showSpeed();
            });
            /** Êí≠Êîæ */
            let play = () => {
                window.clearTimeout(time);
                playsound();
                if (isPlay) {
                    time = window.setTimeout(play, Math.floor(60000 / speed));
                };
            }
            let audioCtx = new AudioContext();
            /** ÂèëÂ£∞ */
            let playsound = () => {
                times++;
                let oscillator = audioCtx.createOscillator();
                let gainNode = audioCtx.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                oscillator.type = 'sine';
                if (times%4){
                    oscillator.frequency.setValueAtTime(200, audioCtx.currentTime);
                }
                else
                {
                    oscillator.frequency.setValueAtTime(700, audioCtx.currentTime);
                    times=0;
                }
                oscillator.frequency.linearRampToValueAtTime(50, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(1, audioCtx.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.5);
                oscillator.start(audioCtx.currentTime);
                oscillator.stop(audioCtx.currentTime + 0.5);
            }
        });
    </script>
</head>

<body>
    <style>
        *{padding: 0;margin: 0;font-family: Cambria, "ÂæÆËΩØÈõÖÈªë";}
        /* header{background-image: linear-gradient(to bottom,#4387fd,#4683ea);padding: 20px;font-size: 30px;color: #fff;} */
        footer{padding: 20px;text-align: center;color: #ccc;}
        footer>a{color: #999;}
        .section{text-align: center;padding: 20px;width: 300px;margin: auto;}
        .sectionsection{margin: 30px auto;}
        .speed{display: flex;justify-content:space-between;align-items: center;}
        .sectionbutton {padding: 5px 10px;}
        #btnTest {padding: 15px 30px;font-size: 20px;}
        #btnPlay,#btnStop{font-size: 50px;border: 0;background: transparent;}
        #btnStop {display: none;}
        #speed{font-size: 45px;}
        #speed1,#speed2{color: #999;cursor: pointer;}
        #speed1:hover,#speed2:hover{color: #333;}
        #msg{height: 20px;padding-top: 5px; font-size: 9px;color: gray;}
    </style>
    <header>ËäÇÊãçÂô®</header>
    <section class="section">
        <button class="sectionbutton" id="btnTest">ËøûÁª≠ÁÇπÂáªÊµãÈÄü</button>
        <div id="msg"></div>
        <section class='sectionsection'>
            <div class="speed">
                <button id="btnSub">‚ûñ</button>
                <div id="speed1">30</div>
                <div id="speed">60</div>
                <div id="speed2">120</div>
                <button id="btnAdd">‚ûï</button>
            </div>
            <div><input type="range" style="width:100%;" min="20" max="300" id="rangeValue" value="60"></div>
        </section>
        <button id="btnPlay">‚ñ∂Ô∏è</button>
        <button id="btnStop">‚èπÔ∏è</button>
    </section>
    <footer>2018-02-05 by <a href="mailto://zk1218@gmail.com">üìß zhangkai</a></footer>
</body>

</html>